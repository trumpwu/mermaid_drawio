flowchart TD
    A[開始排查] --> B{確認現場連線狀態}
    B -->|無法連線| C[嘗試現場連線]
    B -->|可連線| D{確認網路連通性}
    
    C --> C1[前往現場]
    C1 --> C2[確認電源及實體連線]
    C2 --> D
    
    D --> D1[Ping 內網測試]
    D1 -->|失敗| D1F[檢查內部網路設定]
    D1 -->|成功| D2[Ping 外網測試<br/>ping 8.8.8.8]
    D2 -->|失敗| D2F[檢查外部網路設定<br/>路由/防火牆/DNS]
    D2 -->|成功| E{檢查系統資源}
    
    E --> E1[檢查儲存空間<br/>df -h]
    E1 -->|空間不足| E1F[清理不必要檔案]
    E1 -->|空間充足| E2[檢查CPU/記憶體<br/>top]
    E2 -->|資源異常| E2F[重啟服務或設備]
    E2 -->|資源正常| F{檢查MQTT連線}
    
    F --> F1[檢查MQTT連線狀態<br/>mosquitto_sub -t '#']
    F1 -->|連線失敗| F1F[檢查MQTT配置文件<br/>IP/埠口/帳密]
    F1 -->|連線成功| F2[檢查MQTT Topic配置]
    F2 -->|Topic不正確| F2F[修正Topic配置<br/>並重啟MQTT服務]
    F2 -->|Topic正確| G{測試MQTT訊息收發}
    
    G --> G1[從平台發送測試訊息]
    G1 --> G2{ECU是否收到訊息}
    G2 -->|未收到| G2F[檢查ECU訂閱設定<br/>查看日誌檔]
    G2 -->|收到| H{檢查韌體版本}
    
    H --> H1[確認ECU韌體版本<br/>與Edgelink兼容性]
    H1 -->|版本不兼容| H1F[更新韌體/軟體<br/>至兼容版本]
    H1 -->|版本兼容| I[確認問題解決]
    
    F1F --> F
    F2F --> G
    D1F --> D
    D2F --> D
    E1F --> E
    E2F --> E
    G2F --> J[檢查ECU日誌檔<br/>確認錯誤信息]
    H1F --> I
    
    J --> J1[依據錯誤信息<br/>修正問題]
    J1 --> G
    
    I --> K[建立問題報告<br/>更新文檔]
    K --> L[建立預防措施]
    
    L --> L1[設定定期檢查機制<br/>每月確認MQTT設定]
    L1 --> L2[建立ECU設定檔<br/>備份機制]
    L2 --> L3[建立ECU韌體<br/>版本管理機制]
    L3 --> M[結束排查]
